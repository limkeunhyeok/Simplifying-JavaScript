# 자바스크립트 코딩의 기술

## 7장 유연한 함수를 만들어라

### TIP 32 테스트하기 쉬운 함수를 작성하라

- 테스트를 실행할 때 테스트가 외부 API에도 접근해야 한다면, 그 결과 테스트는 네트워크 접근, 응답 시간 등에 의존하게 된다.
  - 모의 객체(mock)을 생성해서 함수를 가로채고 명시적인 반환값을 설정하게 만들어야 한다.
- 스텁(stub)은 외부 코드를 덮어 써서 명시적인 결과를 반환하게 만든다.
- 스파이(spy)는 모의 객체와 비슷하지만, 코드를 실행한 후에 스파이가 어떻게 호출되었는지 확인한다.
- 테스트 코드에 스파이, 모의 객체, 스텁과 같은 여러 가지 외부 헬퍼를 사용하고 있다면 코드가 복잡하고 강하게 결합되어 있다는 증거다.
  - 코드를 단순화해야 한다.
    - 외부 함수를 인수로 전달하면 되며, 의존성을 인수로 전달하는 것을 의존성 주입(dependency injection)이라고 한다.
- 의존성 주입을 사용하면 테스트를 작성할 때 불러오기를 생략할 필요가 없으며, 그 대신에 필요한 값을 반환하는 간단한 함수를 전달하면 되고, 외부 의존성이 모두 제거된다.

### TIP 33 화살표 함수로 복잡도를 낮춰라

- 화살표 함수에서 객체를 반환하는 경우에는 객체를 괄호로 감싸야 한다.
- 고차 함수는 그저 다른 함수를 반환하는 함수일 뿐이다.
- 고차 함수는 매개변수를 가두는 데 사용할 수 있을 뿐만 아니라, 배열 메서드와 나머지 매개변수에도 도움을 줄 수 있다.

### TIP 34 부분 적용 함수로 단일 책임 매개변수를 관리하라

- 고차 함수는 매개변수를 가두는 방법을 통해 특별한 값을 제공하므로, 나중에 원래의 인수에 접근할 수 있게 해두고 함수 실행을 마칠 수 있다.
  - 또한, 매개변수를 분리해 함수의 의도를 명확하게 유지할 수 있다.
- 고차 함수는 다른 함수를 반환하는 함수이며, 함수 실행이 완전히 끝날 때까지 최소한 두 단계에 걸친 매개변수가 존재한다.
- 부분 적용 함수를 이용하면 한 번에 전달해야 할 인수의 수가 줄어드는 대신 인수를 더 전달해야 하는 다른 함수를 반환한다.
- 어떤 입력값은 서로 관련되어 있지만, 다른 입력값은 더 독립적이다.
- 부분 적용과 고차 함수는 나머지 매개변수를 재사용할 수 있다.

### TIP 35 커링과 배열 메서드를 조합한 부분 적용 함수를 사용하라

- 고차 함수에서 반환된 함수는 바로 다시 호출할 필요가 없다.
- 고차 함수를 이용하면 매개변수를 별도로 분리할 수 있다.
  - 허나, 함수를 완전히 분리하기 전에 함수에 필요한 인수를 줄일 수 있도록 인수를 분리하는 것이 중요하다.
- 한 번에 인수를 하나만 받는 함수를 커링이라 하며, 부분 적용 함수는 여러 개의 인수를 받을 수 있다.
- 커링은 인수가 하나만 있어야 하는 함수를 작성할 때 훌륭한 도구이다.

### TIP 36 화살표 함수로 문맥 혼동을 피하라

- 유효 범위는 함수와 연관되어 있고, 문맥은 객체와 연관되어 있다.
- setTimeout(), setInterval(), map() 등 메서드는 콜백 함수를 받으면서 콜백 함수의 문맥도 변경한다.
- 함수는 호출할 때마다 호출되는 위치를 바탕으로 this 바인딩을 만든다.
- 화살표 함수는 함수를 호출할 때 this 바인딩을 새로 만들지 않는다.
- 화살표 함수는 이미 문맥이 있고 다른 함수 내부에서 이 함수를 사용하려고 할 때 유용하다.
  - 허나, 새로운 this 바인딩을 설정할 필요가 있을 때는 문제가 된다.
